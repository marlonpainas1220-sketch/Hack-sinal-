<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TERRA PRO - SIGNAL COMMANDER</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <style>
        :root { --glow: #00ff88; --mesh: #00d4ff; --bg: #000; --panel: #111; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: #fff; margin: 0; padding: 10px; }
        
        /* NOVO PAINEL DE DIAGNÓSTICO */
        .signal-dashboard { background: var(--panel); border-radius: 20px; padding: 15px; border: 1px solid #333; margin-bottom: 12px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .diag-item { background: #000; padding: 10px; border-radius: 12px; border: 1px solid #222; text-align: left; }
        .diag-label { font-size: 0.6rem; color: #888; text-transform: uppercase; }
        .diag-value { font-size: 1.1rem; font-weight: bold; color: var(--glow); font-family: monospace; }
        
        /* GRÁFICO DE ONDA */
        .wave-container { grid-column: span 2; height: 30px; display: flex; align-items: flex-end; gap: 2px; padding: 5px; }
        .bar { flex: 1; background: var(--glow); min-height: 2px; transition: height 0.2s; opacity: 0.6; }

        .card { background: var(--panel); border-radius: 20px; padding: 15px; border: 1px solid #222; margin-bottom: 10px; }
        .btn { display: block; padding: 15px; border-radius: 12px; font-weight: bold; text-decoration: none; border: none; cursor: pointer; width: 100%; box-sizing: border-box; font-size: 0.9rem; margin-top: 5px; }
    </style>
</head>
<body>

    <div class="signal-dashboard">
        <div class="diag-item">
            <span class="diag-label">POTÊNCIA REAL</span>
            <div id="dbm-val" class="diag-value">-- dBm</div>
        </div>
        <div class="diag-item">
            <span class="diag-label">QUALIDADE (SNR)</span>
            <div id="snr-val" class="diag-value">OTIMIZANDO</div>
        </div>
        <div class="diag-item">
            <span class="diag-label">ESTABILIDADE</span>
            <div id="jitter-val" class="diag-value">-- %</div>
        </div>
        <div class="diag-item">
            <span class="diag-label">VAZÃO (DATA)</span>
            <div id="thru-val" class="diag-value">0 bps</div>
        </div>
        <div class="wave-container" id="wave">
            </div>
    </div>

    <div class="card">
        <button class="btn" style="background:var(--glow); color:#000;" onclick="initCommander()">INICIALIZAR DIAGNÓSTICO</button>
    </div>

    <div class="card">
        <div style="display:flex; gap:5px;">
            <a href="sms:" class="btn" style="background:#5fc9f8; color:#000; flex:1;">iMESSAGE</a>
            <a href="https://api.whatsapp.com/send?text=Sinal_Estavel" class="btn" style="background:#25d366; color:#fff; flex:1;">WHATSAPP</a>
        </div>
        <button class="btn" style="background:var(--mesh); color:#000; margin-top:10px;" onclick="document.getElementById('m-box').style.display='block'">ABRIR HUB MESH</button>
    </div>

    <script>
        let lastAcc = 0;
        let waveBars = [];
        
        // Criar barras do gráfico
        const waveCont = document.getElementById('wave');
        for(let i=0; i<30; i++) {
            let b = document.createElement('div');
            b.className = 'bar';
            waveCont.appendChild(b);
            waveBars.push(b);
        }

        function initCommander() {
            alert("Sensores de rádio e GPS vinculados ao Dashboard!");
            navigator.geolocation.watchPosition(p => {
                const acc = p.coords.accuracy;
                const dbm = Math.round(-50 - (acc / 2));
                const jitter = Math.abs(acc - lastAcc).toFixed(1);
                
                document.getElementById('dbm-val').innerText = dbm + " dBm";
                document.getElementById('jitter-val').innerText = (100 - (jitter * 2)).toFixed(0) + "%";
                document.getElementById('thru-val').innerText = (acc < 10 ? "BANDA ALTA" : "RESQUÍCIO");
                
                // Atualizar gráfico
                waveBars.forEach(b => {
                    let h = Math.random() * (100 / (acc/5));
                    b.style.height = Math.min(100, h) + "%";
                });

                lastAcc = acc;
            }, null, {enableHighAccuracy: true});
        }
    </script>
</body>
</html>
